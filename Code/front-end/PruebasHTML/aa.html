<a id="download">Download
    <button id="stop">Stop
    <script> 
    //   let shouldStop = false;
    //   let stopped = false;
    //   const downloadLink = document.getElementById('download');
    //   const stopButton = document.getElementById('stop');
    
    //   stopButton.addEventListener('click', function() {
    //     shouldStop = true;
    //   })
    
    //   var handleSuccess = function(stream) {  
    //     var context = new AudioContext();
    // var input = context.createMediaStreamSource(stream)
    // var processor = context.createScriptProcessor(1024,1,1);

    // // source.connect(processor);
    // processor.connect(context.destination);

    // processor.onaudioprocess = function(e){
    //   // Do something with the data, i.e Convert this to WAV
    //   console.log(e);
    // };
    //     const options = {mimeType: 'video/webm;codecs=vp9'};
    //     const recordedChunks = [];
    //     const mediaRecorder = new MediaRecorder(stream, options);  
    //     console.log("hi2")
    //     mediaRecorder.addEventListener('dataavailable', function(e) {
    //       if (e.data.size > 0) {
    //         recordedChunks.push(e.data);
    //         console.log(e.data)
    //         console.log("hi")
    //       }
    
    //       if(shouldStop === true && stopped === false) {
    //         mediaRecorder.stop();
    //         stopped = true;
    //       }
    //     });
    
    //     mediaRecorder.addEventListener('stop', function() {
    //       downloadLink.href = URL.createObjectURL(new Blob(recordedChunks));
    //       downloadLink.download = 'acetest.wav';
    //     });
    
    //     mediaRecorder.start();
    //   };
    
    //   navigator.mediaDevices.getUserMedia({ audio: true, video: false })
    //       .then(handleSuccess);
    
    function gotStream(stream) {
    window.AudioContext = window.AudioContext || window.webkitAudioContext;
    var audioContext = new AudioContext();
    console.log("Entre",stream)
    // Create an AudioNode from the stream.
    var mediaStreamSource = audioContext.createMediaStreamSource( stream );
    
    // Connect it to the destination to hear yourself (or any other node for processing!)
    mediaStreamSource.connect( audioContext.destination );
}

// navigator.mediaDevices.getUserMedia= navigator.mediaDevices.getUserMedia || navigator.webkitGetUserMedia;
navigator.mediaDevices.getUserMedia({audio:true}).then(gotStream)

    </script>